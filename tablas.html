<script>
    
    function extraerContactos(datos)
    {
     let contactos = [];
     for(let i = 1 ; i<datos.length; i++)
     {
        let contacto =
        {
            nombre: datos[i][0],
            apellidos: datos[i][1],
            correo: datos[i][2],
            telf: datos[i][3],
            imagen: datos[i][4],
            fila: i+1   //el contacto que este en la segunda fila, es el primer contacto pero esta en la fila 2
        };
        contactos.push(contacto);
     }
     return contactos;
    }

    function extraerColumnas(datos)
    {
        let columnas = [];
        for( let i = 0; i<datos[0].length; i++)
        {
            columnas.push(datos[0][i])
        }
        columnas.push('OPCIONES');
        return columnas;
    }

    function eliminarTabla() 
    {
        let tabla = document.getElementById('tablaContactos');
        //si existe la borramos
        if(tabla) tabla.remove();
    }

    function crearTablaContactos() {
        //limpiamos tabla
        limpiar();

        google.script.run
            .withSuccessHandler(crearTablaContactosCorrectamente)
            .withFailureHandler(crearTablaContactosError)
            .obtenerDatos();

    }

    function crearTablaContactosError() 
    {
        //MOSTRAR NOTIFICACION DE ERROR >>>>ERROR<<<<<<<
        crearNotificacionError('No se han podido leer los contactos', 'ERROR');
        eliminarLoader();
    }


    function crearTablaContactosCorrectamente(datos) 
    {
            //extraer contactos y columnas
            let contactos = extraerContactos(datos);
            let columnas = extraerColumnas(datos);

            //crearemos la tabla
            tabla = document.createElement('table');
            //le ponemos id para identificarla
             tabla.id = 'tablaContactos';

            //crearemos la cabecera y agregamos a tabla
             tabla.appendChild(crearHeaderTabla(columnas));
        
            //creamos cuerpo y agregar tabla
            tabla.appendChild(crearBodyTabla(contactos));

            // agregamos el clases styles a la tabla
            tabla.classList.add('table', 'table-striped', 'border', 'border-4', 'border-dark');
            //agregar a la web

       
            // agregamos tabla a la pagina
            document.getElementById('divContactos').appendChild(tabla);

            //ELIMINAMOS EL LOADER
            eliminarLoader();
    }

    function crearHeaderTabla(columnas)
    {
        let tablaHeader = document.createElement('thead');
        // agregamos clases a la cabecera
        tablaHeader.classList.add('table-dark');
        //creamos HEADER de las columnas de la tabla
        let primeraFila = document.createElement('tr');

        //agregamos columnas
        columnas.forEach(columna => 
        {
            let celda = document.createElement('td');
            celda.textContent = columna;
            primeraFila.appendChild(celda);
        });
        //agregamos fila al header
        tablaHeader.appendChild(primeraFila);

        return tablaHeader;
    }

    function crearBodyTabla(contactos)
    {
        let tablaBody = document.createElement('tbody');
        
        contactos.forEach(contacto =>
        {
            let fila = document.createElement('tr');
                        
            // agregaremos las celdas
            fila.appendChild(crearCelda(contacto.nombre));
            fila.appendChild(crearCelda(contacto.apellidos));
            fila.appendChild(crearCelda(contacto.correo));
            fila.appendChild(crearCelda(contacto.telf));
            fila.appendChild(crearCeldaImagen(contacto.imagen));
            fila.appendChild(crearCeldaBotones(contacto));

            //agregaremos la fila
            tablaBody.appendChild(fila);

        });
        return tablaBody;
    }

    function crearCelda(dato)
    {
        let celda = document.createElement('td');
        celda.textContent = dato;
        return celda;
    }

    function crearCeldaImagen(rutaImagen)
    {
        let celda = document.createElement('td');
        let imagen = document.createElement('img');
        imagen.classList.add('img-fluid', 'rounded') //para que sea RESPONSIVE img-fluid y ROUNDED borde redondeado
        imagen.src = rutaImagen; //indicamos la fuente SRC que se corresponde con el nombre la URL de la imagen
        celda.appendChild(imagen);
        
        return celda;
    }

    function crearCeldaBotones(contacto)//<<es el numero fila que tendremos que borrar y lo pasamos como parametro a la funciÃ³n borrar contacto
    {
        //crear celda
        let celda = document.createElement('td');
        celda.classList.add('text-center');

        celda.appendChild(crearBotonInfoContacto(contacto));
        celda.appendChild(crearBotonBorrarContacto(contacto));
        celda.appendChild(crearBotonModificarContacto(contacto));
        return celda;
    }

</script>